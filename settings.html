<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Settings - Inventory Management System</title>
  <link rel="stylesheet" href="styles.css">
</head>
<style>
  /* Dark Mode Header */
  body.dark-mode header {
    background: #1a252f;
    border-bottom: 1px solid #2c3e50;
  }
  body.dark-mode header h1 {
    color: #ecf0f1;
  }
</style>
<body>
  <!-- Main App Sidebar -->
  <nav id="app-sidebar">
    <div class="sidebar-brand">
      <img src="Logo.jpg" alt="Logo" class="sidebar-logo" style="height:32px;width:auto;margin-right:8px">
      <span class="brand-text">IMS</span>
      <button id="main-sidebar-toggle" class="sidebar-toggle-btn" title="Toggle Sidebar">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
      </button>
    </div>
    <ul class="sidebar-menu">
      <li>
        <button onclick="window.location.href='homepage.html'" data-tooltip="Homepage">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="menu-icon"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
          <span class="menu-text">Homepage</span>
        </button>
      </li>
      <li>
        <button data-tooltip="Document Monitoring">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="menu-icon"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
          <span class="menu-text">Document Monitoring</span>
        </button>
        <ul class="sidebar-submenu">
						<li><button onclick="window.location.href='index.html'">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:16px;height:16px"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
              IAAF Monitoring</button></li>
						<li><button onclick="window.location.href='ir_monitoring.html'">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:16px;height:16px"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
              IR Monitoring</button></li>

        </ul>
      </li>
      <li>
        <button data-tooltip="Inventory Tracker">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="menu-icon"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>
        <span class="menu-text">Inventory Tracker</span>
        </button>
        <ul class="sidebar-submenu">
          <li><button onclick="window.location.href='cycle_count.html'">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:16px;height:16px"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.36-3.36L23 10"></path><path d="M20.49 15a9 9 0 0 1-14.36 3.36L1 14"></path></svg>
            Cycle Count</button></li>
          <li><button onclick="window.location.href='cycle_count_reports.html'">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:16px;height:16px"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>
            Cycle Count Report</button></li>
					<li><button onclick="window.location.href='cycle_count_completion.html'">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:16px;height:16px"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
            Cycle Count Completion</button></li>
          <li><button onclick="window.location.href='cycle_count_schedule.html'">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:16px;height:16px"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
            Cycle Count Schedule</button></li>
        </ul>
      </li>
      <li><button class="active" data-tooltip="Settings">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="menu-icon"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
        <span class="menu-text">Settings</span>
      </button></li>
    </ul>
  </nav>

  <header>
    <h1>Settings</h1>
    <div class="navbar" role="navigation">
      <div class="nav-left">
      </div>
      <div class="nav-right">
        <div class="nav-notifications">
          <button class="notification-btn" title="Notifications">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:20px;height:20px"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>
            <span class="notification-badge">0</span>
          </button>
          <div class="notification-menu">
            <div class="notification-header"><span>Notifications</span><button class="clear-notifications">Clear All</button></div>
            <ul class="notification-list"></ul>
          </div>
        </div>
        <div id="clock" class="clock" aria-live="polite"></div>
        <div class="nav-user" id="nav-user">
          <a href="profile.html" title="Profile" style="text-decoration:none; margin-right: 4px;"><span id="nav-avatar" class="avatar small"></span></a>
          <button class="user-btn" id="user-btn" aria-haspopup="true" aria-expanded="false"><span id="username-display"></span> <span id="role-badge" class="role-badge" style="display:none;margin-left:8px"></span></button>
          <div class="user-menu" id="user-menu" role="menu" aria-label="User menu">
            <a href="profile.html" id="profile-btn" role="menuitem">Profile</a>
            <a href="settings.html" role="menuitem">Settings</a>
            <button id="logout-btn" role="menuitem">Logout</button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main>
    <div class="card">
      <h2>Application Settings</h2>
      <p class="muted">Configure your application preferences.</p>
      
      <form id="settings-form" style="max-width: 400px; margin-top: 20px;">
        <div style="margin-bottom: 15px;">
          <label style="display:block; margin-bottom: 5px; font-weight: bold;">Theme</label>
          <select id="theme-select" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ccc;">
            <option value="light">Light</option>
            <option value="dark">Dark</option>
            <option value="system">System Default</option>
          </select>
        </div>
        
        <div style="margin-bottom: 15px;">
          <label style="display:block; margin-bottom: 5px; font-weight: bold;">Notifications</label>
          <div style="display: flex; align-items: center; gap: 10px;">
            <input type="checkbox" id="notif-email" checked>
            <label for="notif-email" style="margin:0;">Email Notifications</label>
          </div>
          <div style="display: flex; align-items: center; gap: 10px; margin-top: 5px;">
            <input type="checkbox" id="notif-push" checked>
            <label for="notif-push" style="margin:0;">Push Notifications</label>
          </div>
        </div>

        <div style="margin-bottom: 15px;">
          <label style="display:block; margin-bottom: 5px; font-weight: bold;">Data Refresh Rate</label>
          <select style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ccc;">
            <option value="15">Every 15 seconds</option>
            <option value="30">Every 30 seconds</option>
            <option value="60">Every minute</option>
            <option value="manual">Manual only</option>
          </select>
        </div>

        <button type="submit">Save Changes</button>
      </form>
    </div>

    <div class="card" style="margin-top: 20px;">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h2>System Logs</h2>
        <button id="clear-logs-btn" style="display:none; background: #d9534f; color: white; border:none; padding:6px 12px; border-radius:4px; cursor:pointer;">Clear Logs</button>
      </div>
      <p class="muted">Recent system activities and audit trails.</p>
      <table id="system-logs-table" style="width:100%; border-collapse: collapse; margin-top: 10px;">
        <thead>
          <tr style="background: #f9fbfd; border-bottom: 1px solid #eee;">
            <th style="padding: 8px; text-align: left;">Timestamp</th>
            <th style="padding: 8px; text-align: left;">User</th>
            <th style="padding: 8px; text-align: left;">Action</th>
            <th style="padding: 8px; text-align: left;">Details</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </main>

  <script src="app.js"></script>
  <script>
    // Ensure sidebar toggle works by re-initializing if needed or relying on app.js
    // app.js handles sidebar toggle on DOMContentLoaded
    // app.js handles clock update
    // app.js handles user auth display

    // Check admin role for Clear Logs button
    const STORAGE_KEY_LOGS = 'ims_system_logs_v1';
    const role = sessionStorage.getItem('dms_auth_role_v1');
    const clearBtn = document.getElementById('clear-logs-btn');

    function renderLogs(){
      const tbody = document.querySelector('#system-logs-table tbody');
      if(!tbody) return;
      let logs = [];
      try {
        const stored = localStorage.getItem(STORAGE_KEY_LOGS);
        if(stored) logs = JSON.parse(stored);
        else {
          // Default demo logs
          logs = [
             { timestamp: '2023-10-27 10:30', user: 'admin', action: 'Login', details: 'Successful login' },
             { timestamp: '2023-10-27 10:35', user: 'admin', action: 'Update Doc', details: 'Updated ECOM-2023-001 status to Approved' },
             { timestamp: '2023-10-27 11:00', user: 'user1', action: 'Create Doc', details: 'Created new document ECOM-2023-005' }
          ];
          localStorage.setItem(STORAGE_KEY_LOGS, JSON.stringify(logs));
        }
      } catch(e){ logs = []; }
      
      tbody.innerHTML = '';
      if(logs.length === 0){
        tbody.innerHTML = '<tr><td colspan="4" class="muted" style="text-align:center; padding:20px;">Logs cleared.</td></tr>';
        return;
      }
      logs.forEach(l => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td style="padding: 8px; border-bottom: 1px solid #eee;">${l.timestamp}</td><td style="padding: 8px; border-bottom: 1px solid #eee;">${l.user}</td><td style="padding: 8px; border-bottom: 1px solid #eee;">${l.action}</td><td style="padding: 8px; border-bottom: 1px solid #eee;">${l.details}</td>`;
        tbody.appendChild(tr);
      });
    }
    renderLogs();

    if(role === 'admin' && clearBtn){
      clearBtn.style.display = 'block';
      clearBtn.addEventListener('click', () => {
        if(confirm('Are you sure you want to clear all system logs?')){
          localStorage.setItem(STORAGE_KEY_LOGS, JSON.stringify([]));
          renderLogs();
        }
      });
    }

    // Settings Form Logic
    const settingsForm = document.getElementById('settings-form');
    const themeSelect = document.getElementById('theme-select');
    
    if(themeSelect){
      themeSelect.value = localStorage.getItem('ims_theme') || 'light';
    }

    if(settingsForm){
      settingsForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const theme = themeSelect ? themeSelect.value : 'light';
        localStorage.setItem('ims_theme', theme);
        if(window.applyTheme) window.applyTheme();
        alert('Settings saved!');
      });
    }
  </script>
</body>
</html>